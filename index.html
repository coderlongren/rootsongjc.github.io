<!DOCTYPE html>
<html class="no-js" lang="en-US" prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#">
<head>
	<meta name="generator" content="Hugo 0.21-DEV" />
    <meta charset="utf-8">

    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="description" content="">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1">


<meta name="keywords" content="">

 
<meta property="og:type" content="article"/>
<meta property="og:description" content=""/>
<meta property="og:title" content="Jimmy Song&#39;s Blog : rootsongjc.github.io"/>
<meta property="og:site_name" content="rootsongjc is Jimmy Song"/>
<meta property="og:image" content="" />
<meta property="og:image:type" content="image/jpeg" />
<meta property="og:image:width" content="" />
<meta property="og:image:height" content="" />
<meta property="og:url" content="http://jimmysong.io/">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2017-08-18"/>
<meta property="article:modified_time" content="2017-08-18"/>





<meta name="twitter:card" content="summary">

<meta name="twitter:site" content="@rootsongjc">
<meta name="twitter:title" content="Jimmy Song&#39;s Blog : rootsongjc.github.io">
<meta name="twitter:creator" content="@rootsongjc">
<meta name="twitter:description" content="">
<meta name="twitter:image:src" content="">
<meta name="twitter:domain" content="rootsongjc.github.io">


    <base href="http://jimmysong.io/">
    <title>Jimmy Song&#39;s Blog</title>
    <link rel="canonical" href="http://jimmysong.io/">

    
<link rel="stylesheet" href="/static/css/style.css">
<script src="https://yandex.st/highlightjs/8.0/highlight.min.js"></script>
<link rel="stylesheet" href="https://yandex.st/highlightjs/8.0/styles/default.min.css">
<script>
    hljs.initHighlightingOnLoad();
</script>

<script>
    var _hmt = _hmt || [];
    (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?11f7d254cfa4e0ca44b175c66d379ecc";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>

<script>
    (function() {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>
<div style='margin:0 auto;width:0px;height:0px;overflow:hidden; '>
    <img src='http://olz1di9xf.bkt.clouddn.com/jimmy.jpg' />
</div>
</head>
<body lang="en">

<header id="header">
    <figure>
      <a href="/" border=0 id="logolink"><div class="icon-octocat" id="logo"> </div></a>
    </figure>
    <div id="byline">by Jimmy Song</div>
    <nav id="nav">
            <ul id="mainnav">
            <li>
                <a href="/blogs/">
                <span class="icon"> <i aria-hidden="true" class="icon-quill"></i></span>
                <span> blogs </span>
            </a>
            </li>
            <li>
            <a href="/projects/">
                <span class="icon"> <i aria-hidden="true" class="icon-console"></i></span>
                <span> projects </span>
            </a>
            </li>
            <li>
            <a href="/talks/">
                <span class="icon"> <i aria-hidden="true" class="icon-stats"></i></span>
                <span> talks </span>
            </a>
            </li>
            <li>
            <a href="http://www.linkedin.com/in/rootsongjc">
                <span class="icon"> <i aria-hidden="true" class="icon-linkedin"></i></span>
                <span> me </span>
            </a>
            </li>
        </ul>

            <ul id="social">
            <li id="share">
                <span class="icon icon-bubbles"> </span>
                <span class="title"> share </span>
                <div class="dropdown share">
                    <ul class="social">
                      <li> <a href="https://twitter.com/intent/tweet?status=Jimmy%20Song%27s%20Blog-http%3a%2f%2fjimmysong.io%2f" target="_blank" title="Follow me on Twitter" class="twitter"><span class="icon icon-twitter"></span>Twitter</a> </li>
                        <li> <a href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2fjimmysong.io%2f" target="_blank" title="Join me on Facebook" class="facebook"><span class="icon icon-facebook"></span>Facebook</a> </li>
                        <li> <a href="https://plus.google.com/share?url=http%3a%2f%2fjimmysong.io%2f" target="_blank" title="Google+" class="googleplus"><span class="icon icon-google-plus"></span>Google+</a> </li>
                        <li> <a href="http://www.linkedin.com/shareArticle?mini=true&url=http%3a%2f%2fjimmysong.io%2f&title=Jimmy%20Song%27s%20Blog&source=spf13" target="_blank" title="LinkedIn" class="linkedin"><span class="icon icon-linkedin"></span>LinkedIn</a> </li>
                        <li> <a href="http://del.icio.us/post?url=http%3a%2f%2fjimmysong.io%2f" target="_blank" title="Delicious" class="delicious"><span class="icon icon-delicious"></span>Delicious</a> </li>
                        <li> <a href="http://www.reddit.com/submit?url=http%3a%2f%2fjimmysong.io%2f" target="_blank" title="Reddit" class="reddit"><span class="icon icon-reddit"></span>Reddit</a> </li>
                    </ul>
                    <span class="subcount">sharing is caring</span>
                </div>
            </li>
            <li id="follow">
                <span class="icon icon-rocket"> </span>
                <span class="title"> follow </span>
                <div class="dropdown follow">
                    <ul class="social">
                        <li> <a href="http://www.twitter.com/rootsongjc" target="_blank" title="Follow me on Twitter" class="twitter"><span class="icon icon-twitter"></span>Twitter</a> </li>
                        <li> <a href="http://www.facebook.com/rootsongjc" target="_blank" title="Join me on Facebook" class="facebook"><span class="icon icon-facebook"></span>Facebook</a> </li>
                        <li> <a href="http://www.linkedin.com/in/rootsongjc" target="_blank" title="LinkedIn" class="linkedin"><span class="icon icon-linkedin"></span>LinkedIn</a> </li>
                        <li> <a href="http://github.com/rootsongjc" target="_blank" title="GitHub" class="github"><span class="icon icon-github"></span>GitHub</a> </li>
                        <li> <a href="https://www.douban.com/people/deamonj/" target="_blank" title="豆瓣" class="facebook"><span class="icon icon-idea"></span>Douban</a> </li>
                        <li> <a href="https://tuchong.com/1425795/" target="_blank" title="图虫" class="github"><span class="icon icon-cc-2"></span>Tuchong</a> </li>                    </ul>
                    <span class="subcount">join 10k+ subscribers &amp; followers</span>
                </div>
            </li>
          </ul>

    </nav>
</header>


<section id="main">
  <div>
      <h1 id="title">Jimmy Song&#39;s Blog</h1>
    
        <article class="post">
    <header>
      <h2><a href="http://jimmysong.io/talks/change-domain-name/">从今日起更换域名为jimmysong.io </a> </h2>
      <div class="post-meta">Fri, Aug 18, 2017 </div>
    </header>

    从即日起我有了自己的独立域名 jimmysong.io，网站依然托管在 GitHub 上，proudly powered by hugo。
为什么使用 .io 作为后缀呢？因为这是 The First Step to Cloud Native！
为什么选择在今天？因为今天是8月18日，日子好记。
P.S 域名注册于 namecheap，费用几十美元/年。
🎉🎊🎉
    <footer>
        <a href='http://jimmysong.io/talks/change-domain-name/'><nobr>Read more →</nobr></a>
    </footer>
</article>

    
        <article class="post">
    <header>
      <h2><a href="http://jimmysong.io/blogs/kubernetes-tls-bootstrapping/">Kubernetes TLS bootstrap引导程序 </a> </h2>
      <div class="post-meta">Wed, Aug 16, 2017 </div>
    </header>

    按照 kubernetes-handbook 安装 kubernetes 集群的第一步是什么？没错，创建 TLS 证书和秘钥！作为第一步已经这么繁琐和容易出错，很多人就望而却步了，单纯的按照说明执行命令而不了解这样做的目录和命令的含义无法帮助我们进行问题排查和纠错。
Bootstrap 是很多系统中都存在的程序，比如 Linux 的bootstrap，bootstrap 一般都是作为预先配置在开启或者系统启动的时候加载，这可以用来生成一个指定环境。Kubernetes 的 kubelet 的启动时同样可以加载一个这样的配置文件，这个文件的内容类似如下形式：
02b50b05283e98dd0fd71db496ef01e8,kubelet-bootstrap,10001,&quot;system:kubelet-bootstrap&quot;  下面将为您详细解释 TLS bootstrap 是如何配置和生成的（下文是 kubernetes 官方文档的中文版）。
TLS Bootstrap 本文档介绍如何为 kubelet 设置 TLS 客户端证书引导（bootstrap）。
Kubernetes 1.4 引入了一个用于从集群级证书颁发机构（CA）请求证书的 API。此 API 的原始目的是为 kubelet 提供 TLS 客户端证书。可以在 这里 找到该提议，在 feature #43 追踪该功能的进度。
kube-apiserver 配置 您必须提供一个 token 文件，该文件中指定了至少一个分配给 kubelet 特定 bootstrap 组的 “bootstrap token”。
该组将作为 controller manager 配置中的默认批准控制器而用于审批。随着此功能的成熟，您应该确保 token 被绑定到基于角色的访问控制（RBAC）策略上，该策略严格限制了与证书配置相关的客户端请求（使用 bootstrap token）。使用 RBAC，将 token 范围划分为组可以带来很大的灵活性（例如，当您配置完成节点后，您可以禁用特定引导组的访问）。
Token 认证文件 Token 可以是任意的，但应该可以表示为从安全随机数生成器（例如大多数现代操作系统中的 /dev/urandom）导出的至少128位熵。生成 token 有很多中方式。例如：
    <footer>
        <a href='http://jimmysong.io/blogs/kubernetes-tls-bootstrapping/'><nobr>Read more →</nobr></a>
    </footer>
</article>

    
        <article class="post">
    <header>
      <h2><a href="http://jimmysong.io/talks/cloud-native-python/">Cloud Native Python—使用Python和React构建云原生应用 </a> </h2>
      <div class="post-meta">Tue, Aug 15, 2017 </div>
    </header>

    继 Cloud Native Go 之后又一本关于 Cloud Native 的力作已经登上了我的写作日程，这次是基于 Python 构建微服务和云原生 Web 应用程序，书名叫作 Cloud Native Python。
下面是它的英文原版书（感谢电子工业出版社）跟它已出版的好兄弟 Cloud Native Go 在一起的合影。
这本书跟 Cloud Native Go 的内容由很大部分的重合，目录结构也基本一致，所用的技术栈也很类似，不过内容更详实，图片和步骤介绍更多一些，跟我看的另一本由印度人写的 Kubernetes Management Design Patterns: With Docker, CoreOS Linux, and Other Platforms 的风格很像。
Cloud Native Python 介绍 随着当今商业的迅速发展，企业为了支撑自身的迅速扩张，仅仅通过自有的基础设施是远远不够的。因此，他们一直在追求利用云的弹性来构建支持高度可扩展应用程序的平台。
这本书能够帮助您一站式的了解使用Python构建云原生应用架构的所有信息。本书中我们首先向您介绍云原生应用架构和他们能够帮助您解决哪些问题。然后您将了解到如何使用REST API和Python构建微服务，通过事件驱动的方式构建Web层。接下来，您将了解到如何与数据服务进行交互，并使用React构建Web视图，之后我们将详细介绍应用程序的安全性和性能。然后，您还将了解到如何Docker容器化您的服务。最后，您将学习如何在AWS和Azure平台上部署您的应用程序。在您部署了应用程序后，我们将围绕关于应用程序故障排查的一系列概念和技术来结束这本书。
本书中涵盖哪些内容 第1章 介绍云原生应用架构和微服务，讨论云原生架构的基本概念和构建应用程序开发环境。
第2章 使用Python构建微服务，构建自己的微服务知识体系并根据您的用例进行扩展。
第3章 使用Python构建Web应用程序，构建一个初始的Web应用程序并与微服务集成。
第4章 与数据服务交互，教您如何将应用程序迁移到不同的数据库服务。
第5章 使用React构建Web视图。
第6章 使用Flux创建可扩展UI，帮助您理解如何使用Flux创建可扩展的应用程序。
第7章 事件溯源和CQRS，讨论如何以事件形式存储合约（transaction）。
第8章 保护Web应用程序，让您的应用程序免于受到外部威胁。
第9章 持续交付，应用程序频繁发布的相关知识。
第10章 Docker容器化您的服务，讨论容器服务和在Docker中运行应用程序。
第11章 将应用程序部署到AWS平台上，教您如何在AWS上构建基础设施并建立应用程序的生产环境。
第12章 将应用程序部署到Azure平台上，讨论如何在Azure上构建基础设施并建立应用程序的生产环境。
    <footer>
        <a href='http://jimmysong.io/talks/cloud-native-python/'><nobr>Read more →</nobr></a>
    </footer>
</article>

    
        <article class="post">
    <header>
      <h2><a href="http://jimmysong.io/blogs/linkerd-user-guide/">Linkerd 使用指南 </a> </h2>
      <div class="post-meta">Tue, Aug 1, 2017 </div>
    </header>

    前言 该文章已归档到 kubernetes-handbook 第五章【领域应用】中，一切内容以 kubernetes-handbook 为准，该文档可能不会及时更新。
以下内容参考：A Service Mesh for Kubernetes
Linkerd 作为一款 service mesh 与kubernetes 结合后主要有以下几种用法：
 作为服务网关，可以监控 kubernetes 中的服务和实例 使用 TLS 加密服务 通过流量转移到持续交付 开发测试环境（Eat your own dog food）、Ingress 和边缘路由 给微服务做 staging 分布式 tracing 作为 Ingress controller 使用 gRPC 更方便  以下我们着重讲解在 kubernetes 中如何使用 linkerd 作为 kubernetes 的 Ingress controller，并作为边缘节点代替 Traefik的功能，详见 边缘节点的配置。
准备 安装测试时需要用到的镜像有：
buoyantio/helloworld:0.1.4 buoyantio/jenkins-plus:2.60.1 buoyantio/kubectl:v1.4.0 buoyantio/linkerd:1.1.2 buoyantio/namerd:1.1.2 buoyantio/nginx:1.10.2 linkerd/namerctl:0.8.6 openzipkin/zipkin:1.20 tutum/dnsutils:latest  这些镜像可以直接通过 Docker Hub 获取，我将它们下载下来并上传到了自己的私有镜像仓库 sz-pg-oam-docker-hub-001.
    <footer>
        <a href='http://jimmysong.io/blogs/linkerd-user-guide/'><nobr>Read more →</nobr></a>
    </footer>
</article>

    
        <article class="post">
    <header>
      <h2><a href="http://jimmysong.io/talks/migrating-to-cloud-native-architecture/">迁移到云原生应用架构指南 </a> </h2>
      <div class="post-meta">Thu, Jul 27, 2017 </div>
    </header>

    迁移到云原生应用架构 本书是 Migrating to Cloud Native Application Architectures 的中文版。
本书托管地址：https://github.com/rootsongjc/migrating-to-cloud-native-application-architectures
Gitbook 阅读地址：https://rootsongjc.gitbooks.io/moving-to-cloud-native-archtecture
译者序 云时代的云原生应用大势已来，将传统的单体架构应用迁移到云原生架构，你准备好了吗？
俗话说“意识决定行动”，在迁移到云原生应用之前，我们大家需要先对 Cloud Native（云原生）的概念、组织形式并对实现它的技术有一个大概的了解，这样才能指导我们的云原生架构实践。
Pivotal 是云原生应用的提出者，并推出了 Pivotal Cloud Foundry 云原生应用平台和 Spring 开源 Java 开发框架，成为云原生应用架构中先驱者和探路者。
原书作于2015年，其中的示例主要针对 Java 应用，实际上也适用于任何应用类型，云原生应用架构适用于异构语言的程序开发，不仅仅是针对 Java 语言的程序开发。截止到本人翻译本书时，云原生应用生态系统已经初具规模，CNCF 成员不断发展壮大，基于 Cloud Native 的创业公司不断涌现，kubernetes 引领容器编排潮流，和 Service Mesh 技术（如 Linkerd 和 Istio） 的出现，Go 语言的兴起（参考另一本书 Cloud Native Go）等为我们将应用迁移到云原生架构的提供了更多的方案选择。
Jimmy Song
简介 当前很多企业正在采用云原生应用程序架构，这可以帮助其IT转型，成为市场竞争中真正敏捷的力量。 O&rsquo;Reilly 的报告中定义了云原生应用程序架构的特性，如微服务和十二因素应用程序。
本书中作者Matt Stine还探究了将传统的单体应用和面向服务架构（SOA）应用迁移到云原生架构所需的文化、组织和技术变革。本书中还有一个迁移手册，其中包含将单体应用程序分解为微服务，实施容错模式和执行云原生服务的自动测试的方法。
本书中讨论的应用程序架构包括：
 十二因素应用程序：云原生应用程序架构模式的集合 微服务：独立部署的服务，只做一件事情 自助服务的敏捷基础设施：快速，可重复和一致地提供应用环境和后台服务的平台 基于API的协作：发布和版本化的API，允许在云原生应用程序架构中的服务之间进行交互 抗压性：根据压力变强的系统  关于作者
Matt Stine，Pivotal的技术产品经理，拥有15年企业IT和众多业务领域的经验。 Matt 强调精益/敏捷方法、DevOps、架构模式和编程范例，他正在探究使用技术组合帮助企业IT部门能够像初创公司一样工作。
    <footer>
        <a href='http://jimmysong.io/talks/migrating-to-cloud-native-architecture/'><nobr>Read more →</nobr></a>
    </footer>
</article>

    
        <article class="post">
    <header>
      <h2><a href="http://jimmysong.io/blogs/deploy-applications-in-kubernetes/">适用于kubernetes的应用开发与部署流程详解 </a> </h2>
      <div class="post-meta">Thu, Jul 20, 2017 </div>
    </header>

    （题图：风和日丽@野三坡 Jul 14,2017）
本文已归档在kubernetes-handbook中的第3章【用户指南】中，一切更新以kubernetes-handbook中为准。
为了详细说明，我特意写了两个示例程序放在GitHub中，模拟应用开发流程：
 k8s-app-monitor-test：生成模拟的监控数据，发送http请求，获取json返回值 K8s-app-monitor-agent：获取监控数据并绘图，访问浏览器获取图表  API文档见k8s-app-monitor-test中的api.html文件，该文档在API blueprint中定义，使用aglio生成，打开后如图所示：
关于服务发现
K8s-app-monitor-agent服务需要访问k8s-app-monitor-test服务，这就涉及到服务发现的问题，我们在代码中直接写死了要访问的服务的内网DNS地址（kubedns中的地址，即k8s-app-monitor-test.default.svc.cluster.local）。
我们知道Kubernetes在启动Pod的时候为容器注入环境变量，这些环境变量在所有的 namespace 中共享（环境变量是不断追加的，新启动的Pod中将拥有老的Pod中所有的环境变量，而老的Pod中的环境变量不变）。但是既然使用这些环境变量就已经可以访问到对应的service，那么获取应用的地址信息，究竟是使用变量呢？还是直接使用DNS解析来发现？
答案是使用DNS，详细说明见Kubernetes中的服务发现与Docker容器间的环境变量传递源码探究。
打包镜像
因为我使用wercker自动构建，构建完成后自动打包成docker镜像并上传到docker hub中（需要现在docker hub中创建repo）。
构建流程见：https://app.wercker.com/jimmysong/k8s-app-monitor-agent/
生成了如下两个docker镜像：
 jimmysong/k8s-app-monitor-test:latest jimmysong/k8s-app-monitor-agent:latest  启动服务
所有的kubernetes应用启动所用的yaml配置文件都保存在那两个GitHub仓库的manifest.yaml文件中。
分别在两个GitHub目录下执行kubectl create -f manifest.yaml即可启动服务。
外部访问
服务启动后需要更新ingress配置，在ingress.yaml文件中增加以下几行：
- host: k8s-app-monitor-agent.jimmysong.io http: paths: - path: / backend: serviceName: k8s-app-monitor-agent servicePort: 8080  保存后，然后执行kubectl replace -f ingress.yaml即可刷新ingress。
修改本机的/etc/hosts文件，在其中加入以下一行：
172.20.0.119 k8s-app-monitor-agent.jimmysong.io  当然你也可以加入到DNS中，为了简单起见我使用hosts。
详见边缘节点配置。
在浏览器中访问http://k8s-app-monitor-agent.jimmysong.io
刷新页面将获得新的图表。
    <footer>
        <a href='http://jimmysong.io/blogs/deploy-applications-in-kubernetes/'><nobr>Read more →</nobr></a>
    </footer>
</article>

    
        <article class="post">
    <header>
      <h2><a href="http://jimmysong.io/talks/book-kubernetes-management-design-patterns/">记一本关于kubernetes management design patterns的书 </a> </h2>
      <div class="post-meta">Thu, Jul 20, 2017 </div>
    </header>

    书名： Kubernetes Management Design Patterns: With Docker, CoreOS Linux, and Other Platforms
Amazon购买链接：链接
作者：Deepak Vohra
发行日期：2017年1月20日
出版社：Apress
页数：399
简介 Kubernetes引领容器集群管理进入一个全新的阶段；学习如何在CoreOS上配置和管理kubernetes集群；使用适当的管理模式，如ConfigMaps、Autoscaling、弹性资源使用和高可用性配置。讨论了kubernetes的一些其他特性，如日志、调度、滚动升级、volume、服务类型和跨多个云供应商zone。
Kubernetes中的最小模块化单位是Pod，它是拥有共同的文件系统和网络的系列容器的集合。Pod的抽象层可以对容器使用设计模式，就像面向对象设计模式一样。容器能够提供与软件对象（如模块化或包装，抽象和重用）相同的优势。
在大多数章节中使用的都是CoreOS Linux，其他讨论的平台有CentOS，OpenShift，Debian 8（jessie），AWS和Debian 7 for Google Container Engine。
使用CoreOS主要是因为Docker已经在CoreOS上开箱即用。CoreOS：
 支持大多数云提供商（包括Amazon AWS EC2和Google Cloud Platform）和虚拟化平台（如VMWare和VirtualBox） 提供Cloud-Config，用于声明式配置OS，如网络配置（flannel），存储（etcd）和用户帐户 为容器化应用提供生产级基础架构，包括自动化，安全性和可扩展性 引领容器行业标准，并建立了应用程序标准 提供最先进的容器仓库，Quay  Docker于2013年3月开源，现已称为最流行的容器平台。kubernetes于2014年6月开源，现在已经成为最流行的容器集群管理平台。第一个稳定版CoreOS Linux于2014年7月发行，现已成为最流行的容器操作系统之一。
你将学到什么  使用docker和kubernetes 在AWS和CoreOS上创建kubernetes集群 应用集群管理设计模式 使用多个云供应商zone 使用Ansible管理kubernetes 基于kubernetes的PAAS平台OpenShift 创建高可用网站 构建高可用用的kubernetes master集群 使用volume、configmap、serivce、autoscaling和rolling update 管理计算资源 配置日志和调度  谁适合读这本书 Linux管理员、CoreOS管理员、应用程序开发者、容器即服务（CAAS）开发者。阅读这本书需要Linux和Docker的前置知识。介绍Kubernetes的知识，例如创建集群，创建Pod，创建service以及创建和缩放replication controller。还需要一些关于使用Amazon Web Services（AWS）EC2，CloudFormation和VPC的必备知识。
关于作者 Deepak Vohra is an Oracle Certified Associate and a Sun Certified Java Programmer.
    <footer>
        <a href='http://jimmysong.io/talks/book-kubernetes-management-design-patterns/'><nobr>Read more →</nobr></a>
    </footer>
</article>

    
        <article class="post">
    <header>
      <h2><a href="http://jimmysong.io/blogs/exploring-kubernetes-env-with-docker/">Kubernetes中的服务发现与docker容器间的环境变量传递源码探究 </a> </h2>
      <div class="post-meta">Wed, Jul 19, 2017 </div>
    </header>

    （题图：雷雨@野三坡 Jul 13,2017）
前言 今天创建了两个kubernetes示例应用：
 k8s-app-monitor-test：启动server用来产生metrics
 k8s-app-monitor-agent：获取metrics并绘图，显示在web上
  注：相关的kubernetes应用manifest.yaml文件分别见以上两个应用的GitHub 。
当我查看Pod中的环境变量信息时，例如kubernetes中的service k8s-app-monitor-test注入的环境变量时，包括了以下变量：
K8S_APP_MONITOR_TEST_PORT_3000_TCP_ADDR=10.254.56.68 K8S_APP_MONITOR_TEST_PORT=tcp://10.254.56.68:3000 K8S_APP_MONITOR_TEST_PORT_3000_TCP_PROTO=tcp K8S_APP_MONITOR_TEST_SERVICE_PORT_HTTP=3000 K8S_APP_MONITOR_TEST_PORT_3000_TCP_PORT=3000 K8S_APP_MONITOR_TEST_PORT_3000_TCP=tcp://10.254.56.68:3000 K8S_APP_MONITOR_TEST_SERVICE_HOST=10.254.56.68 K8S_APP_MONITOR_TEST_SERVICE_PORT=3000  我们知道Kubernetes在启动Pod的时候为容器注入环境变量，这些环境变量将在该Pod所在的namespace中共享。但是既然使用这些环境变量就已经可以访问到对应的service，那么获取应用的地址信息，究竟是使用变量呢？还是直接使用DNS解析来发现？下面我们从代码中来寻求答案。
如果不想看下面的文字，可以直接看图。
探索 docker的docker/engine-api/types/container/config.go中的Config结构体中有对环境变量的定义：
// Config contains the configuration data about a container. // It should hold only portable information about the container. // Here, &quot;portable&quot; means &quot;independent from the host we are running on&quot;. // Non-portable information *should* appear in HostConfig. // All fields added to this struct must be marked `omitempty` to keep getting // predictable hashes from the old `v1Compatibility` configuration.
    <footer>
        <a href='http://jimmysong.io/blogs/exploring-kubernetes-env-with-docker/'><nobr>Read more →</nobr></a>
    </footer>
</article>

    
        <article class="post">
    <header>
      <h2><a href="http://jimmysong.io/projects/awesome-cloud-native/">Awesome Cloud Native </a> </h2>
      <div class="post-meta">Tue, Jul 18, 2017 </div>
    </header>

    这是一份记录关于Cloud Native的软件、工具、架构以及参考资料的列表，是我在GitHub上开的一个项目，地址是https://github.com/rootsongjc/awesome-cloud-native。
初步划分成以下这些领域：
Awesome Cloud Native
 API Containers CI-CD Database Logging Message broker Monitoring Networking Orchestration and scheduler PaaS Proxy and load balancer Service mesh Service registry and discovery Storage Tracing Tools Tutorial  今后会不断更新和完善该列表，不仅是为了本人平时的研究记录，也作为Cloud Native届的人士的参考。
    <footer>
        <a href='http://jimmysong.io/projects/awesome-cloud-native/'><nobr>Read more →</nobr></a>
    </footer>
</article>

    
        <article class="post">
    <header>
      <h2><a href="http://jimmysong.io/blogs/changes-needed-to-cloud-native-archtecture/">企业迁移到云生应用架构时所需做出的变革 </a> </h2>
      <div class="post-meta">Sun, Jul 16, 2017 </div>
    </header>

    本文译自Migrating to Cloud Native Application Architectures第二部分，归档到https://github.com/rootsongjc/migrating-to-cloud-native-application-architectures 。
在变革中前行 从客户给我们下达订单开始，一直到我们收到现金为止，我们一直都关注时间线。而且我们正在通过删除非附加值的废物来减少这个时间表。
—— Taichi Ohno
Taichi Ohno被公认为精益制造之父。 虽然精益制造的实践无法完全适用于软件开发领域，但它们的原则是一致的。 这些原则可以指导我们很好地寻求典型的企业IT组织采用云原生应用程序架构所需的变革，并且接受作为这一转变所带来的部分的文化和组织转型。
文化变革 企业IT采用云原生架构所需的变革根本不是技术性的，而是企业文化和组织的变革，围绕消除造成浪费的结构、流程和活动。 在本节中，我们将研究必要的文化转变。
从信息孤岛到DevOps 企业IT通常被组织成以下许多孤岛：
 软件开发 质量保证 数据库管理 系统管理 IT运营 发布管理 项目管理  创建这些孤岛是为了让那些了解特定领域的人员来管理和指导那些执行该专业领域工作的人员。 这些孤岛通常具有不同的管理层次，工具集、沟通风格、词汇表和激励结构。这些差异启发了企业IT目标的不同范式，以及如何实现这一目标。
开发和运维分别对软件变更持有的观念就是个经常被提起的关于这些矛盾模式的例子。 开发的任务通常被视为通过开发软件功能为组织提供额外的价值。 这些功能本身就是向IT生态系统引入变更。 所以开发的使命可以被描述为“交付变化”，而且经常根据有多少次变更来进行激励。
相反，IT运营的使命可以被描述为“防止变更”。 IT运营通常负责维护IT系统所需的可用性、弹性、性能和耐用性。因此，他们经常以维持关键绩效指标（KPI）来进行激励，例如平均故障间隔时间（MTBF）和平均恢复时间（MTTR）。与这些措施相关的主要风险因素之一是在系统中引入任何类型的变更。 那么，不是设法将开发期望的变更安全地引入IT生态系统，而是通过将流程放在一起，使变更变得痛苦，从而降低了变化率。
这些不同的范式显然导致了许多额外的工作。项目工作中的协作、沟通和简单的交接变得乏味和痛苦，最糟糕的是导致绝对混乱（甚至是危险的）。 企业IT通常通过创建基于单据的系统和委员会会议驱动的复杂流程来尝试“修复”这种情况。企业IT价值流在所有非增值浪费下步履瞒珊。
像这样的环境与云原生的速度思想背道而驰。 专业的信息孤岛和流程往往是由创造安全环境的愿望所驱动。然而，他们通常提供很少的附加安全性，在某些情况下，会使事情变得更糟！
在其核心上，DevOps代表着这样一种思想，即将这些信息孤岛构建成共享的工具集、词汇表和沟通结构，以服务于专注于单一目标的文化：快速、安全得交付价值。 然后创建激励结构，强制和奖励领导组织朝着这一目标迈进的行为。 官僚主义和流程被信任和责任所取代。
在这个新的世界中，开发和IT运营部门向共同的直接领导者汇报，并进行合作，寻找能够持续提供价值并获得期望的可用性、弹性、性能和耐久性水平的实践。今天，这些对背景敏感的做法越来越多地包括采用云原生应用架构，提供完成组织的新的共同目标所需的技术支持。
从间断均衡到持续交付 企业经常采用敏捷流程，如Scrum，但是只能作为开发团队内部的本地优化。
在这个行业中，我们实际上已经成功地将个别开发团队转变为更灵活的工作方式。 我们可以这样开始项目，撰写用户故事，并执行敏捷开发的所有例程，如迭代计划会议，日常站会，回顾和客户展示demo。 我们中的冒险者甚至可能会冒险进行工程实践，如结对编程和测试驱动开发。持续集成，这在以前是一个相当激进的概念，现在已经成为企业软件词典的标准组成部分。事实上，我已经是几个企业软件团队中的一部分，并建立了高度优化的“故事到演示”周期，每个开发迭代的结果在客户演示期间被热烈接受。
但是，这些团队会遇到可怕的问题：我们什么时候可以在生产环境中看到这些功能？
这个问题是我们很难回答，因为它迫使我们考虑我们无法控制的力量：
 我们需要多长时间才能浏览独立的质量保证流程？ 我们什么时候可以加入生产发布的行列中？ 我们可以让IT运营及时为我们提供生产环境吗？  在这一点上，我们意识到自己已经陷入了戴维·韦斯特哈斯（Dave Westhas）所说的scrum瀑布中了。 我们的团队已经开始接受敏捷原则，但我们的组织却没有。所以，不是每次迭代产生一次生产部署（这是敏捷宣言的原始出发点），代码实际上是批量参与一个更传统的下游发布周期。
这种操作风格产生直接的后果。我们不是每次迭代都将价值交付给客户，并将有价值的反馈回到开发团队，我们继续保持“间断均衡”的交付方式。 间断均衡实际上丧失了敏捷交付的两个主要优点：
 客户可能需要几周的时间才能看到软件带来的新价值。 他们认为，这种新的敏捷工作方式只是“像往常一样”，不会增强对开发团队的信任。 因为他们没有看到可靠的交付节奏，他们回到了以前的套路将尽可能多的要求尽可能多地堆放到发布版上。 为什么？ 因为他们对软件能够很快发布没有信心，他们希望尽可能多的价值被包括在最终交付时。 开发团队可能会好几周都没有得到真正的反馈。虽然演示很棒，但任何经验丰富的开发人员都知道，只有真实用户参与到软件之中才能获得最佳反馈。这些反馈能够帮助软件修正，使团队去做正确的事情。反馈推迟后，错误的可能性只能增加，并带来昂贵的返工。  获得云原生应用程序体系结构的好处需要我们转变为持续交付。 我们拥抱端到端拥抱价值的原则，而不是Water Scrum Fall组织驱动的间断平衡。设想这样一个生命周期的模型是由Mary和Tom Poppendieck在《实施精益软件开发（Addison-Wesley）》一书中描述的“概念到现金”的想法中提出来的。 这种方法考虑了所有必要的活动，将业务想法从概念传递到创造利润的角度，并构建可以使人们和过程达到最佳目标的价值流。
    <footer>
        <a href='http://jimmysong.io/blogs/changes-needed-to-cloud-native-archtecture/'><nobr>Read more →</nobr></a>
    </footer>
</article>

    
  </div>
</section>

<aside id="meta"> </aside>

<footer>
  <div>
    <p>
    &copy; 2013-2017 <span itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Jimmy Song</span></span>
    Powered by <a href="http://gohugo.io">Hugo</a>.
    </p>
  </div>
</footer>
</body>
</html>

