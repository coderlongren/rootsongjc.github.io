<!DOCTYPE html>
<html class="no-js" lang="en-US" prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#">

<head>
    <meta charset="utf-8">
    <meta name="baidu-site-verification" content="g8IYR9SNLF" />
    <meta name="uyan_auth" content="419f63884b" /> <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="description" content="">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1">


<meta name="keywords" content="kubernetes, cloud computing, ">

 
<meta property="og:type" content="article"/>
<meta property="og:description" content=""/>
<meta property="og:title" content="Kubernetes Dashboard/Web UI安装全记录 : jimmysong.io"/>
<meta property="og:site_name" content="rootsongjc is Jimmy Song"/>
<meta property="og:image" content="" />
<meta property="og:image:type" content="image/jpeg" />
<meta property="og:image:width" content="" />
<meta property="og:image:height" content="" />
<meta property="og:url" content="http://rootsongjc.github.io/blogs/kubernetes-dashboard-installation/">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2017-04-05"/>
<meta property="article:modified_time" content="2017-04-05"/>



<meta property="article:tag" content="kubernetes">
<meta property="article:tag" content="cloud computing">




<meta name="twitter:card" content="summary">

<meta name="twitter:site" content="@rootsongjc">
<meta name="twitter:title" content="Kubernetes Dashboard/Web UI安装全记录 : jimmysong.io">
<meta name="twitter:creator" content="@rootsongjc">
<meta name="twitter:description" content="">
<meta name="twitter:image:src" content="">
<meta name="twitter:domain" content="jimmysong.io">

    <base href="http://rootsongjc.github.io/">
    <title> Kubernetes Dashboard/Web UI安装全记录 - Jimmy Song </title>
    <link rel="canonical" href="http://rootsongjc.github.io/blogs/kubernetes-dashboard-installation/"> <link rel="stylesheet" href="/static/css/style.css">


<link href="/static/css/prism.css" rel="stylesheet" />
<script src="/static/js/prism.js"></script>


<script>
    var _hmt = _hmt || [];
    (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?11f7d254cfa4e0ca44b175c66d379ecc";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>

<script>
    (function() {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>
<div style='margin:0 auto;width:0px;height:0px;overflow:hidden; '>
    <img src='http://olz1di9xf.bkt.clouddn.com/jimmy.jpg' />
</div>
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
</head>

<body lang="en" itemscope itemtype="http://schema.org/Article">
    <header id="header">
    <figure>
      <a href="/" border=0 id="logolink"><div class="icon-octocat" id="logo"> </div></a>
    </figure>
    <div id="byline">by Jimmy Song</div>
    <nav id="nav">
    <ul id="mainnav">
    <li>
        <a href="/blogs/">
            <span class="icon"> <i aria-hidden="true" class="icon-quill"></i></span>
            <span> blogs </span>
        </a>
    </li>
    <li>
        <a href="/projects/">
            <span class="icon"> <i aria-hidden="true" class="icon-console"></i></span>
            <span> projects </span>
        </a>
    </li>
    <li>
        <a href="/talks/">
            <span class="icon"> <i aria-hidden="true" class="icon-stats"></i></span>
            <span> talks </span>
        </a>
    </li>
    <li>
        <a href="http://www.linkedin.com/in/rootsongjc">
            <span class="icon"> <i aria-hidden="true" class="icon-linkedin"></i></span>
            <span> me </span>
        </a>
    </li>
</ul>
    <ul id="social">
    <li id="share">
        <span class="icon icon-bubbles"> </span>
        <span class="title"> share </span>
        <div class="dropdown share">
            <ul class="social">
                <li> <a href="https://twitter.com/intent/tweet?status=Kubernetes%20Dashboard%2fWeb%20UI%e5%ae%89%e8%a3%85%e5%85%a8%e8%ae%b0%e5%bd%95-http%3a%2f%2frootsongjc.github.io%2fblogs%2fkubernetes-dashboard-installation%2f" target="_blank" title="Follow me on Twitter" class="twitter"><span class="icon icon-twitter"></span>Twitter</a> </li>
                <li> <a href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2frootsongjc.github.io%2fblogs%2fkubernetes-dashboard-installation%2f" target="_blank" title="Join me on Facebook" class="facebook"><span class="icon icon-facebook"></span>Facebook</a> </li>
                <li> <a href="https://plus.google.com/share?url=http%3a%2f%2frootsongjc.github.io%2fblogs%2fkubernetes-dashboard-installation%2f" target="_blank" title="Google+" class="googleplus"><span class="icon icon-google-plus"></span>Google+</a> </li>
                <li> <a href="http://www.linkedin.com/shareArticle?mini=true&url=http%3a%2f%2frootsongjc.github.io%2fblogs%2fkubernetes-dashboard-installation%2f&title=Kubernetes%20Dashboard%2fWeb%20UI%e5%ae%89%e8%a3%85%e5%85%a8%e8%ae%b0%e5%bd%95&source=spf13" target="_blank" title="LinkedIn" class="linkedin"><span class="icon icon-linkedin"></span>LinkedIn</a> </li>
                <li> <a href="http://del.icio.us/post?url=http%3a%2f%2frootsongjc.github.io%2fblogs%2fkubernetes-dashboard-installation%2f" target="_blank" title="Delicious" class="delicious"><span class="icon icon-delicious"></span>Delicious</a> </li>
                <li> <a href="http://www.reddit.com/submit?url=http%3a%2f%2frootsongjc.github.io%2fblogs%2fkubernetes-dashboard-installation%2f" target="_blank" title="Reddit" class="reddit"><span class="icon icon-reddit"></span>Reddit</a> </li>
            </ul>
            <span class="subcount">sharing is caring</span>
        </div>
    </li>
    <li id="follow">
        <span class="icon icon-rocket"> </span>
        <span class="title"> follow </span>
        <div class="dropdown follow">
            <ul class="social">
                <li> <a href="http://www.twitter.com/rootsongjc" target="_blank" title="Follow me on Twitter" class="twitter"><span class="icon icon-twitter"></span>Twitter</a> </li>
                <li> <a href="http://www.facebook.com/rootsongjc" target="_blank" title="Join me on Facebook" class="facebook"><span class="icon icon-facebook"></span>Facebook</a> </li>
                <li> <a href="http://www.linkedin.com/in/rootsongjc" target="_blank" title="LinkedIn" class="linkedin"><span class="icon icon-linkedin"></span>LinkedIn</a> </li>
                <li> <a href="http://github.com/rootsongjc" target="_blank" title="GitHub" class="github"><span class="icon icon-github"></span>GitHub</a> </li>
                <li> <a href="https://www.douban.com/people/deamonj/" target="_blank" title="豆瓣" class="facebook"><span class="icon icon-idea"></span>Douban</a> </li>
                <li> <a href="https://rootsongjc.tuchong.com/" target="_blank" title="图虫" class="github"><span class="icon icon-cc-2"></span>Tuchong</a> </li>
            </ul>
            <span class="subcount">join 10k+ subscribers &amp; followers</span>
        </div>
    </li>
</ul>
    </nav>
</header>
 

    <section id="main">
        <h1 itemprop="name" id="title">Kubernetes Dashboard/Web UI安装全记录</h1>
        <div>
            <article itemprop="articleBody" id="content">
                

<p><img src="http://olz1di9xf.bkt.clouddn.com/2017040301.jpg" alt="晒太阳的袋鼠" /></p>

<p><em>（题图：晒太阳的袋鼠@北京动物园 Apr 3,2017）</em></p>

<h2 id="前言">前言</h2>

<p>前几天<a href="http://rootsongjc.github.io/blogs/kubernetes-installation-on-centos/">在CentOS7.2上安装Kubernetes1.6</a>和安装好<a href="http://rootsongjc.github.io/blogs/kubernetes-network-config/">flannel网络配置</a>，今天我们来安装下kuberentnes的dashboard。</p>

<p><a href="https://github.com/kubernetes/dashboard">Dashboard</a>是Kubernetes的一个插件，代码在单独的开源项目里。1年前还是特别简单的一个UI，只能在上面查看pod的信息和部署pod而已，现在已经做的跟<a href="https://www.docker.com/enterprise-edition">Docker Enterprise Edition</a>的<strong>Docker Datacenter</strong>很像了。</p>

<h2 id="安装dashboard">安装Dashboard</h2>

<p>官网的安装文档<a href="https://kubernetes.io/docs/user-guide/ui/，其实官网是让我们使用现成的image来用kubernetes部署即可。">https://kubernetes.io/docs/user-guide/ui/，其实官网是让我们使用现成的image来用kubernetes部署即可。</a></p>

<p>首先需要一个<strong>kubernetes-dashboard.yaml</strong>的配置文件，可以直接在<a href="https://github.com/kubernetes/dashboard/blob/master/src/deploy/kubernetes-dashboard.yaml">Github的src/deploy/kubernetes-dashboard.yaml</a>下载。</p>

<p>我们能看下这个文件的内容：</p>

<pre><code class="language-yaml"># Copyright 2015 Google Inc. All Rights Reserved.
#
# Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

# Configuration to deploy release version of the Dashboard UI.
#
# Example usage: kubectl create -f &lt;this_file&gt;

kind: Deployment
apiVersion: extensions/v1beta1
metadata:
  labels:
    app: kubernetes-dashboard
  name: kubernetes-dashboard
  namespace: kube-system
spec:
  replicas: 1
  revisionHistoryLimit: 10
  selector:
    matchLabels:
      app: kubernetes-dashboard
  template:
    metadata:
      labels:
        app: kubernetes-dashboard
      # Comment the following annotation if Dashboard must not be deployed on master
      annotations:
        scheduler.alpha.kubernetes.io/tolerations: |
          [
            {
              &quot;key&quot;: &quot;dedicated&quot;,
              &quot;operator&quot;: &quot;Equal&quot;,
              &quot;value&quot;: &quot;master&quot;,
              &quot;effect&quot;: &quot;NoSchedule&quot;
            }
          ]
    spec:
      containers:
      - name: kubernetes-dashboard
        image: sz-pg-oam-docker-hub-001.tendcloud.com/library/kubernetes-dashboard-amd64:v1.6.0
        imagePullPolicy: Always
        ports:
        - containerPort: 9090
          protocol: TCP
        args:
          # Uncomment the following line to manually specify Kubernetes API server Host
          # If not specified, Dashboard will attempt to auto discover the API server and connect
          # to it. Uncomment only if the default does not work.
          # - --apiserver-host=http://my-address:port
          - --apiserver-host=http://sz-pg-oam-docker-test-001.tendcloud.com:8080
        livenessProbe:
          httpGet:
            path: /
            port: 9090
          initialDelaySeconds: 30
          timeoutSeconds: 30
---
kind: Service
apiVersion: v1
metadata:
  labels:
    app: kubernetes-dashboard
  name: kubernetes-dashboard
  namespace: kube-system
spec:
  type: NodePort
  ports:
  - port: 80
    targetPort: 9090
  selector:
    app: kubernetes-dashboard
</code></pre>

<p>⚠️ 官方提供的image名为<code>gcr.io/google_containers/kubernetes-dashboard-amd64:v1.6.0</code>，需要翻墙才能访问，我自己拉下来push到我们的私有镜像仓库了。我将这个镜像push到了docker hub上，如果你无法翻墙的话，可以到下载这个镜像：<code>index.tenxcloud.com/jimmy/kubernetes-dashboard-amd64:v1.6.0</code>。时速云的镜像存储，速度就是快。</p>

<p>准备好image后就可以部署了。</p>

<pre><code>$kubectl create -f kubernetes-dashboard.yaml
deployment &quot;kubernetes-dashboard&quot; created
service &quot;kubernetes-dashboard&quot; created
$kubectl get -f kubernetes-dashboard.yaml
NAME                          DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
deploy/kubernetes-dashboard   1         1         1            1           9s

NAME                       CLUSTER-IP       EXTERNAL-IP   PORT(S)        AGE
svc/kubernetes-dashboard   10.254.113.226   &lt;nodes&gt;       80:31370/TCP   8s
</code></pre>

<p>现在就可以访问<a href="http://sz-pg-oam-docker-test-001.tendcloud.com:8080/ui了，效果如图：">http://sz-pg-oam-docker-test-001.tendcloud.com:8080/ui了，效果如图：</a></p>

<p><img src="http://olz1di9xf.bkt.clouddn.com/kubernetes-dashboard-01.jpg" alt="kubernetes-dashboard" /></p>

<h2 id="troubleshooting">Troubleshooting</h2>

<h3 id="如果你没启动service-account身份认证">如果你没启动Service Account身份认证</h3>

<p>那就好办了，检查下你的<strong>kubernetes-dashboard.yaml</strong>文件，看看是不是API Server地址配错了，或者查看下pod的log，我就是在log里发现，原来API Server的主机名无法解析导致服务启动失败。在DNS里添加API Server主机的DNS记录即可。</p>

<h3 id="如果你启动api-server的serviceaccount身份认证">如果你启动API Server的ServiceAccount身份认证</h3>

<p>启动service的时候出错。</p>

<pre><code>kubectl --namespace=kube-system logs kubernetes-dashboard-1680927228-pdv45
Using HTTP port: 9090
Error while initializing connection to Kubernetes apiserver. This most likely means that the cluster is misconfigured (e.g., it has invalid apiserver certificates or service accounts configuration) or the --apiserver-host param points to a server that does not exist. Reason: open /var/run/secrets/kubernetes.io/serviceaccount/token: no such file or directory
Refer to the troubleshooting guide for more information: https://github.com/kubernetes/dashboard/blob/master/docs/user-guide/troubleshooting.md
</code></pre>

<p><a href="https://github.com/kubernetes/dashboard/blob/master/docs/user-guide/troubleshooting.md">troubleshooting.md</a>文件已经说明了，这是可能是你配置API server地址或<strong>Service Account</strong>的问题。</p>

<p>如果是配置Service Account的问题，可以借鉴Tony Bai的<a href="http://tonybai.com/2017/01/19/install-dashboard-addon-for-k8s/">Kubernetes集群Dashboard插件安装</a>这篇文章。</p>

<p><strong>启动</strong></p>

<pre><code>kubectl proxy --address='0.0.0.0' --accept-hosts='^*$'
</code></pre>

<p>报错信息</p>

<pre><code>{
  &quot;kind&quot;: &quot;Status&quot;,
  &quot;apiVersion&quot;: &quot;v1&quot;,
  &quot;metadata&quot;: {},
  &quot;status&quot;: &quot;Failure&quot;,
  &quot;message&quot;: &quot;no endpoints available for service \&quot;kubernetes-dashboard\&quot;&quot;,
  &quot;reason&quot;: &quot;ServiceUnavailable&quot;,
  &quot;code&quot;: 503
}
</code></pre>

<pre><code># start a container that contains curl
$ kubectl run test --image=sz-pg-oam-docker-hub-001.tendcloud.com/library/curl:latest -- sleep 10000
$kubectl get pod
NAME                     READY     STATUS    RESTARTS   AGE
test-2428763157-pxkps    1/1       Running   0          6s
$kubectl exec test-2428763157-pxkps ls /var/run/secrets/kubernetes.io/serviceaccount/
ls: cannot access /var/run/secrets/kubernetes.io/serviceaccount/: No such file or directory
$kubectl get secrets
No resources found.
</code></pre>

<p><code>/var/run/secrets/kubernetes.io/serviceaccount/</code>这个目录还是不存在，我们安装的Kubernetes压根就没有设置secret。</p>

<p><a href="https://github.com/kubernetes/dashboard/blob/master/docs/user-guide/troubleshooting.md">troubleshooting.md</a>上说需要用<code>—admission-control</code>配置API Server，在配置这个之前还要了解下<a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/">Service Accounts</a>和<a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/">如何管理Service Accounts</a>。</p>

<h2 id="后记">后记</h2>

<p>一年前我安装Kubernetes Dashboard（那时候好像还叫Kube-UI）的时候没有其功能还极其不完善，经过一年多的发展，已经有模有样了，如果不启用<strong>Service Account</strong>的话，安装Dashboard还是很简单的。接下来我还要在Dashboard上安装其它Add-on，如Heapster用来监控Pod状态。</p>

            </article>
        </div>
    </section>

    
    

<aside id="meta">

<div>
    <section id="datecount">
        <h4 id="date"> Wed Apr 5, 2017 </h4>
        <h5 id="wc"> 1900 Words </h5>
        <h5 id="readtime"> Read in about 4 Min </h5>
    </section>
    <ul id="categories">
        
    </ul>
    <ul id="tags">
        
        <li> <a href="http://rootsongjc.github.io//tags/kubernetes">kubernetes</a> </li>
        
        <li> <a href="http://rootsongjc.github.io//tags/cloud-computing">cloud computing</a> </li>
        
    </ul>
</div>

<div>
    <section id="prev">
        &nbsp;<a class="previous" href="http://rootsongjc.github.io/blogs/kubernetes-heapster-installation/"><i class="icon-arrow-left"></i> Kubernetes heapster监控插件安装文档</a><br>
    </section>
    <section id="next">
        &nbsp;<a class="next" href="http://rootsongjc.github.io/projects/yarn-on-docker/">容器技术在大数据场景下的应用——Yarn on Docker <i class="icon-arrow-right"></i></a>
    </section>
</div>

<div>
    <section id="author">
        <h4>About the Author</h4>
        <p>
            <a href="http://rootsongjc.github.io/about/">Jimmy Song</a> is a software engineer in Beijing, also an open source enthusiast and Big Data, Cloud Native fans. If you not see him front of computer, he must be traveling or taking pictures outside,
            visit the amazing pictures at <a href=https://rootsongjc.tuchong.com/>tuchong(图虫)</a>. Feel free to <a href=https://twitter.com/rootsongjc>follow him on twitter</a>.
        </p>
    </section>

</div>
</aside>

<meta itemprop="wordCount" content="1819">
<meta itemprop="datePublished" content="2017-04-05">
<meta itemprop="url" content="http://rootsongjc.github.io/blogs/kubernetes-dashboard-installation/">
 <footer>
    <div>
        <p>
            <a href="http://jimmysong.io/kubernetes-handbook">Kubernetes Handbook</a> |
            <a href="http://jimmysong.io/cloud-native-go">Cloud Native Go</a> |
            <a href="http://jimmysong.io/awesome-cloud-native">Awesome Cloud Native</a> |
            <a href="http://jimmysong.io/migrating-to-cloud-native-application-architectures">Migrating to Cloud Native Application Architectures</a>
    </div>
    <div>
        <p>

        </p>
        <p> &copy; 2013-2017 <span itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Jimmy Song</span></span>
            Powered by <a href="http://gohugo.io">Hugo</a> </p>
    </div>
</footer>
</body>

</html>
