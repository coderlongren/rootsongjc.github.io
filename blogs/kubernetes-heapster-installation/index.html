<!DOCTYPE html>
<html class="no-js" lang="en-US" prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#">

<head>
    <meta charset="utf-8">
    <meta name="baidu-site-verification" content="g8IYR9SNLF" />
    <meta name="uyan_auth" content="419f63884b" /> <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="description" content="">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1">


<meta name="keywords" content="kubernetes, cloud computing, ">

 
<meta property="og:type" content="article"/>
<meta property="og:description" content=""/>
<meta property="og:title" content="Kubernetes heapster监控插件安装文档 : jimmysong.io"/>
<meta property="og:site_name" content="rootsongjc is Jimmy Song"/>
<meta property="og:image" content="" />
<meta property="og:image:type" content="image/jpeg" />
<meta property="og:image:width" content="" />
<meta property="og:image:height" content="" />
<meta property="og:url" content="http://rootsongjc.github.io/blogs/kubernetes-heapster-installation/">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2017-04-05"/>
<meta property="article:modified_time" content="2017-04-05"/>



<meta property="article:tag" content="kubernetes">
<meta property="article:tag" content="cloud computing">




<meta name="twitter:card" content="summary">

<meta name="twitter:site" content="@rootsongjc">
<meta name="twitter:title" content="Kubernetes heapster监控插件安装文档 : jimmysong.io">
<meta name="twitter:creator" content="@rootsongjc">
<meta name="twitter:description" content="">
<meta name="twitter:image:src" content="">
<meta name="twitter:domain" content="jimmysong.io">

    <base href="http://rootsongjc.github.io/">
    <title> Kubernetes heapster监控插件安装文档 - Jimmy Song </title>
    <link rel="canonical" href="http://rootsongjc.github.io/blogs/kubernetes-heapster-installation/"> <link rel="stylesheet" href="/static/css/style.css">


<link href="/static/css/prism.css" rel="stylesheet" />
<script src="/static/js/prism.js"></script>


<script>
    var _hmt = _hmt || [];
    (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?11f7d254cfa4e0ca44b175c66d379ecc";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>

<script>
    (function() {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>
<div style='margin:0 auto;width:0px;height:0px;overflow:hidden; '>
    <img src='http://olz1di9xf.bkt.clouddn.com/jimmy.jpg' />
</div>
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
</head>

<body lang="en" itemscope itemtype="http://schema.org/Article">
    <header id="header">
    <figure>
      <a href="/" border=0 id="logolink"><div class="icon-octocat" id="logo"> </div></a>
    </figure>
    <div id="byline">by Jimmy Song</div>
    <nav id="nav">
            <ul id="mainnav">
            <li>
                <a href="/blogs/">
                <span class="icon"> <i aria-hidden="true" class="icon-quill"></i></span>
                <span> blogs </span>
            </a>
            </li>
            <li>
            <a href="/projects/">
                <span class="icon"> <i aria-hidden="true" class="icon-console"></i></span>
                <span> projects </span>
            </a>
            </li>
            <li>
            <a href="/talks/">
                <span class="icon"> <i aria-hidden="true" class="icon-stats"></i></span>
                <span> talks </span>
            </a>
            </li>
            <li>
            <a href="http://www.linkedin.com/in/rootsongjc">
                <span class="icon"> <i aria-hidden="true" class="icon-linkedin"></i></span>
                <span> me </span>
            </a>
            </li>
        </ul>

    <ul id="social">
    <li id="share">
        <span class="icon icon-bubbles"> </span>
        <span class="title"> share </span>
        <div class="dropdown share">
            <ul class="social">
                <li> <a href="https://twitter.com/intent/tweet?status=Kubernetes%20heapster%e7%9b%91%e6%8e%a7%e6%8f%92%e4%bb%b6%e5%ae%89%e8%a3%85%e6%96%87%e6%a1%a3-http%3a%2f%2frootsongjc.github.io%2fblogs%2fkubernetes-heapster-installation%2f" target="_blank" title="Follow me on Twitter" class="twitter"><span class="icon icon-twitter"></span>Twitter</a> </li>
                <li> <a href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2frootsongjc.github.io%2fblogs%2fkubernetes-heapster-installation%2f" target="_blank" title="Join me on Facebook" class="facebook"><span class="icon icon-facebook"></span>Facebook</a> </li>
                <li> <a href="https://plus.google.com/share?url=http%3a%2f%2frootsongjc.github.io%2fblogs%2fkubernetes-heapster-installation%2f" target="_blank" title="Google+" class="googleplus"><span class="icon icon-google-plus"></span>Google+</a> </li>
                <li> <a href="http://www.linkedin.com/shareArticle?mini=true&url=http%3a%2f%2frootsongjc.github.io%2fblogs%2fkubernetes-heapster-installation%2f&title=Kubernetes%20heapster%e7%9b%91%e6%8e%a7%e6%8f%92%e4%bb%b6%e5%ae%89%e8%a3%85%e6%96%87%e6%a1%a3&source=spf13" target="_blank" title="LinkedIn" class="linkedin"><span class="icon icon-linkedin"></span>LinkedIn</a> </li>
                <li> <a href="http://del.icio.us/post?url=http%3a%2f%2frootsongjc.github.io%2fblogs%2fkubernetes-heapster-installation%2f" target="_blank" title="Delicious" class="delicious"><span class="icon icon-delicious"></span>Delicious</a> </li>
                <li> <a href="http://www.reddit.com/submit?url=http%3a%2f%2frootsongjc.github.io%2fblogs%2fkubernetes-heapster-installation%2f" target="_blank" title="Reddit" class="reddit"><span class="icon icon-reddit"></span>Reddit</a> </li>
            </ul>
            <span class="subcount">sharing is caring</span>
        </div>
    </li>
    <li id="follow">
        <span class="icon icon-rocket"> </span>
        <span class="title"> follow </span>
        <div class="dropdown follow">
            <ul class="social">
                <li> <a href="http://www.twitter.com/rootsongjc" target="_blank" title="Follow me on Twitter" class="twitter"><span class="icon icon-twitter"></span>Twitter</a> </li>
                <li> <a href="http://www.facebook.com/rootsongjc" target="_blank" title="Join me on Facebook" class="facebook"><span class="icon icon-facebook"></span>Facebook</a> </li>
                <li> <a href="http://www.linkedin.com/in/rootsongjc" target="_blank" title="LinkedIn" class="linkedin"><span class="icon icon-linkedin"></span>LinkedIn</a> </li>
                <li> <a href="http://github.com/rootsongjc" target="_blank" title="GitHub" class="github"><span class="icon icon-github"></span>GitHub</a> </li>
                <li> <a href="https://www.douban.com/people/deamonj/" target="_blank" title="豆瓣" class="facebook"><span class="icon icon-idea"></span>Douban</a> </li>
                <li> <a href="https://rootsongjc.tuchong.com/" target="_blank" title="图虫" class="github"><span class="icon icon-cc-2"></span>Tuchong</a> </li>
            </ul>
            <span class="subcount">join 10k+ subscribers &amp; followers</span>
        </div>
    </li>
</ul>
    </nav>
</header>
 

    <section id="main">
        <h1 itemprop="name" id="title">Kubernetes heapster监控插件安装文档</h1>
        <div>
            <article itemprop="articleBody" id="content">
                

<p><img src="http://olz1di9xf.bkt.clouddn.com/20170403064.jpg" alt="嗑猫薄荷的白化孟加拉虎" /></p>

<p><em>（题图：嗑猫薄荷的白化孟加拉虎@北京动物园 Apr 3,2017）</em></p>

<h2 id="前言">前言</h2>

<p>前面几篇文章中记录了我们<a href="http://rootsongjc.github.io/blogs/kubernetes-installation-on-centos/">安装好了Kubernetes集群</a>、<a href="http://rootsongjc.github.io/blogs/kubernetes-network-config/">配置好了flannel网络</a>、<a href="http://rootsongjc.github.io/blogs/kubernetes-dashboard-installation/">安装了Kubernetes Dashboard</a>，但是还没法查看Pod的监控信息，虽然kubelet默认集成了<strong>cAdvisor</strong>（在每个node的4194端口可以查看到），但是很不方便，因此我们选择安装heapster。</p>

<h2 id="安装">安装</h2>

<p><strong>下载heapster的代码</strong></p>

<p>直接现在Github上的最新代码。</p>

<pre><code class="language-Shell">git pull https://github.com/kubernetes/heapster.git
</code></pre>

<p>目前的最高版本是1.3.0。</p>

<p>在<code>heapster/deploy/kube-config/influxdb</code>目录下有几个<code>yaml</code>文件：</p>

<pre><code>grafana-deployment.yaml
grafana-service.yaml
heapster-deployment.yaml
heapster-service.yaml
influxdb-deployment.yaml
influxdb-service.yaml
</code></pre>

<p>我们再看下用了哪些镜像：</p>

<pre><code>grafana-deployment.yaml:16:        image: gcr.io/google_containers/heapster-grafana-amd64:v4.0.2
heapster-deployment.yaml:16:        image: gcr.io/google_containers/heapster-amd64:v1.3.0-beta.1
influxdb-deployment.yaml:16:        image: gcr.io/google_containers/heapster-influxdb-amd64:v1.1.1
</code></pre>

<p><strong>下载镜像</strong></p>

<p>我们下载好了这些images后，存储到私有镜像仓库里：</p>

<ul>
<li>sz-pg-oam-docker-hub-001.tendcloud.com/library/heapster-amd64:v1.3.0-beta.1</li>
<li>sz-pg-oam-docker-hub-001.tendcloud.com/library/heapster-grafana-amd64:v4.0.2</li>
<li>sz-pg-oam-docker-hub-001.tendcloud.com/library/heapster-influxdb-amd64:v1.1.1</li>
</ul>

<p>我已经将官方镜像克隆到了<a href="www.tenxcloud.com">时速云</a>上，镜像地址：</p>

<ul>
<li>index.tenxcloud.com/jimmy/heapster-amd64:v1.3.0-beta.1</li>
<li>index.tenxcloud.com/jimmy/heapster-influxdb-amd64:v1.1.1</li>
<li>index.tenxcloud.com/jimmy/heapster-grafana-amd64:v4.0.2</li>
</ul>

<p>需要的可以去下载，下载前需要用时速云账户登陆，然后再执行pull操作。</p>

<pre><code>docker login index.tendcloud.com
</code></pre>

<h2 id="配置">配置</h2>

<p>参考<a href="https://github.com/kubernetes/heapster/blob/master/docs/influxdb.md">Run Heapster in a Kubernetes cluster with an InfluxDB backend and a Grafana UI</a>和<a href="https://github.com/kubernetes/heapster/blob/master/docs/source-configuration.md">Configuring Source</a>，需要修改yaml文件中的几个配置。</p>

<ul>
<li>首先修改三个deployment.yaml文件，将其中的镜像文件地址改成我们自己的私有镜像仓库的</li>
<li>修改heapster-deployment.yaml文件中的<code>--source</code>参数为<code>—source=kubernetes:http://sz-pg-oam-docker-test-001.tendcloud.com:8080?inClusterConfig=false&amp;useServiceAccount=false</code>。</li>
</ul>

<p><strong>修改完配置的<code>heapster-deployment.yaml</code>文件</strong></p>

<pre><code class="language-Yaml">apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  name: heapster
  namespace: kube-system
spec:
  replicas: 1
  template:
    metadata:
      labels:
        task: monitoring
        k8s-app: heapster
    spec:
      containers:
      - name: heapster
        image: sz-pg-oam-docker-hub-001.tendcloud.com/library/heapster-amd64:v1.3.0-beta.1
        imagePullPolicy: IfNotPresent
        command:
        - /heapster
        - --source=kubernetes:http://sz-pg-oam-docker-test-001.tendcloud.com:8080?inClusterConfig=false&amp;useServiceAccount=false
        - --sink=influxdb:http://monitoring-influxdb:8086
</code></pre>

<h2 id="启动">启动</h2>

<p>在准备好镜像和修改完配置文件后就可以一键启动了，这不就是使用kbuernetes的方便之处吗？</p>

<p><strong>启动heaspter</strong></p>

<pre><code class="language-shell">kubectl create -f deploy/kube-config/influxdb
</code></pre>

<p><strong>查看状态</strong></p>

<pre><code>kubectl get -f deploy/kube-config/influxdb/
NAME                        DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
deploy/monitoring-grafana   1         1         1            1           1h

NAME                     CLUSTER-IP      EXTERNAL-IP   PORT(S)   AGE
svc/monitoring-grafana   10.254.250.27   &lt;none&gt;        80/TCP    1h

NAME              DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
deploy/heapster   1         1         1            1           1h

NAME           CLUSTER-IP       EXTERNAL-IP   PORT(S)   AGE
svc/heapster   10.254.244.187   &lt;none&gt;        80/TCP    1h

NAME                         DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
deploy/monitoring-influxdb   1         1         1            1           1h

NAME                      CLUSTER-IP       EXTERNAL-IP   PORT(S)    AGE
svc/monitoring-influxdb   10.254.151.157   &lt;none&gt;        8086/TCP   1h
</code></pre>

<p><strong>查看页面</strong></p>

<p>现在再打开Dashboard页面就可以看到CPU和Memory的监控信息了。</p>

<p><img src="http://olz1di9xf.bkt.clouddn.com/kubernetes-heapster-01.jpg" alt="kubernetes-heapster" /></p>

<h2 id="后记">后记</h2>

<p>虽然在安装了heapster插件后可以在dashboard中看到CPU和Memory的监控信息，但是这仅仅是近实时的监控，收集的metrics被保存到了InfluxDB中，还可以通过Kibana或者Grafana来展示更详细的信息和历史数据，还是有很多事情可以做的。</p>

            </article>
        </div>
    </section>

    
    

<aside id="meta">

<div>
    <section id="datecount">
        <h4 id="date"> Wed Apr 5, 2017 </h4>
        <h5 id="wc"> 1100 Words </h5>
        <h5 id="readtime"> Read in about 3 Min </h5>
    </section>
    <ul id="categories">
        
    </ul>
    <ul id="tags">
        
        <li> <a href="http://rootsongjc.github.io//tags/kubernetes">kubernetes</a> </li>
        
        <li> <a href="http://rootsongjc.github.io//tags/cloud-computing">cloud computing</a> </li>
        
    </ul>
</div>

<div>
    <section id="prev">
        &nbsp;<a class="previous" href="http://rootsongjc.github.io/blogs/tensorflow-and-deep-learning-without-a-phd/"><i class="icon-arrow-left"></i> TensorFlow深度学习手写数字识别初体验</a><br>
    </section>
    <section id="next">
        &nbsp;<a class="next" href="http://rootsongjc.github.io/blogs/kubernetes-dashboard-installation/">Kubernetes Dashboard/Web UI安装全记录 <i class="icon-arrow-right"></i></a>
    </section>
</div>

<div>
    <section id="author">
        <h4>About the Author</h4>
        <p>
            <a href="http://rootsongjc.github.io/about/">Jimmy Song</a> is a software engineer in Beijing, also an open source enthusiast and Big Data, Cloud Native fans. If you not see him front of computer, he must be traveling or taking pictures outside,
            visit the amazing pictures at <a href=https://rootsongjc.tuchong.com/>tuchong(图虫)</a>. Feel free to <a href=https://twitter.com/rootsongjc>follow him on twitter</a>.
        </p>
    </section>

</div>
</aside>

<meta itemprop="wordCount" content="1035">
<meta itemprop="datePublished" content="2017-04-05">
<meta itemprop="url" content="http://rootsongjc.github.io/blogs/kubernetes-heapster-installation/">
 <footer>
    <div>
        <p>
            &copy; 2013-2017 <span itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Jimmy Song</span></span>
            Powered by <a href="http://gohugo.io">Hugo</a>.
        </p>
    </div>
</footer>
</body>

</html>
