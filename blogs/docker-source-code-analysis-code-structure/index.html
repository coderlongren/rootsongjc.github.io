<!DOCTYPE html>
<html class="no-js" lang="en-US" prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#">

<head>
    <meta charset="utf-8">
    <meta name="baidu-site-verification" content="g8IYR9SNLF" />
    <meta name="uyan_auth" content="419f63884b" /> <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="description" content="">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1">


<meta name="keywords" content="docker, docker source code analysis, ">

 
<meta property="og:type" content="article"/>
<meta property="og:description" content=""/>
<meta property="og:title" content="Docker源码分析第一篇——代码结构 : rootsongjc.github.io"/>
<meta property="og:site_name" content="rootsongjc is Jimmy Song"/>
<meta property="og:image" content="" />
<meta property="og:image:type" content="image/jpeg" />
<meta property="og:image:width" content="" />
<meta property="og:image:height" content="" />
<meta property="og:url" content="http://rootsongjc.github.io/blogs/docker-source-code-analysis-code-structure/">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2017-03-19"/>
<meta property="article:modified_time" content="2017-03-19"/>



<meta property="article:tag" content="docker">
<meta property="article:tag" content="docker source code analysis">




<meta name="twitter:card" content="summary">

<meta name="twitter:site" content="@rootsongjc">
<meta name="twitter:title" content="Docker源码分析第一篇——代码结构 : rootsongjc.github.io">
<meta name="twitter:creator" content="@rootsongjc">
<meta name="twitter:description" content="">
<meta name="twitter:image:src" content="">
<meta name="twitter:domain" content="rootsongjc.github.io">

    <base href="http://rootsongjc.github.io/">
    <title> Docker源码分析第一篇——代码结构 - Jimmy Song </title>
    <link rel="canonical" href="http://rootsongjc.github.io/blogs/docker-source-code-analysis-code-structure/"> 
<link rel="stylesheet" href="/static/css/style.css">
<script src="https://yandex.st/highlightjs/8.0/highlight.min.js"></script>
<link rel="stylesheet" href="https://yandex.st/highlightjs/8.0/styles/default.min.css">
<script>
    hljs.initHighlightingOnLoad();
</script>

<script>
    var _hmt = _hmt || [];
    (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?11f7d254cfa4e0ca44b175c66d379ecc";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>

<script>
    (function() {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>
<div style='margin:0 auto;width:0px;height:0px;overflow:hidden; '>
    <img src='http://olz1di9xf.bkt.clouddn.com/jimmy.jpg' />
</div>
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
</head>

<body lang="en" itemscope itemtype="http://schema.org/Article">
    <header id="header">
    <figure>
      <a href="/" border=0 id="logolink"><div class="icon-octocat" id="logo"> </div></a>
    </figure>
    <div id="byline">by Jimmy Song</div>
    <nav id="nav">
            <ul id="mainnav">
            <li>
                <a href="/blogs/">
                <span class="icon"> <i aria-hidden="true" class="icon-quill"></i></span>
                <span> blogs </span>
            </a>
            </li>
            <li>
            <a href="/projects/">
                <span class="icon"> <i aria-hidden="true" class="icon-console"></i></span>
                <span> projects </span>
            </a>
            </li>
            <li>
            <a href="/talks/">
                <span class="icon"> <i aria-hidden="true" class="icon-stats"></i></span>
                <span> talks </span>
            </a>
            </li>
            <li>
            <a href="http://www.linkedin.com/in/rootsongjc">
                <span class="icon"> <i aria-hidden="true" class="icon-linkedin"></i></span>
                <span> me </span>
            </a>
            </li>
        </ul>

    <ul id="social">
    <li id="share">
        <span class="icon icon-bubbles"> </span>
        <span class="title"> share </span>
        <div class="dropdown share">
            <ul class="social">
                <li> <a href="https://twitter.com/intent/tweet?status=Docker%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90%e7%ac%ac%e4%b8%80%e7%af%87%e2%80%94%e2%80%94%e4%bb%a3%e7%a0%81%e7%bb%93%e6%9e%84-http%3a%2f%2frootsongjc.github.io%2fblogs%2fdocker-source-code-analysis-code-structure%2f" target="_blank" title="Follow me on Twitter" class="twitter"><span class="icon icon-twitter"></span>Twitter</a> </li>
                <li> <a href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2frootsongjc.github.io%2fblogs%2fdocker-source-code-analysis-code-structure%2f" target="_blank" title="Join me on Facebook" class="facebook"><span class="icon icon-facebook"></span>Facebook</a> </li>
                <li> <a href="https://plus.google.com/share?url=http%3a%2f%2frootsongjc.github.io%2fblogs%2fdocker-source-code-analysis-code-structure%2f" target="_blank" title="Google+" class="googleplus"><span class="icon icon-google-plus"></span>Google+</a> </li>
                <li> <a href="http://www.linkedin.com/shareArticle?mini=true&url=http%3a%2f%2frootsongjc.github.io%2fblogs%2fdocker-source-code-analysis-code-structure%2f&title=Docker%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90%e7%ac%ac%e4%b8%80%e7%af%87%e2%80%94%e2%80%94%e4%bb%a3%e7%a0%81%e7%bb%93%e6%9e%84&source=spf13" target="_blank" title="LinkedIn" class="linkedin"><span class="icon icon-linkedin"></span>LinkedIn</a> </li>
                <li> <a href="http://del.icio.us/post?url=http%3a%2f%2frootsongjc.github.io%2fblogs%2fdocker-source-code-analysis-code-structure%2f" target="_blank" title="Delicious" class="delicious"><span class="icon icon-delicious"></span>Delicious</a> </li>
                <li> <a href="http://www.reddit.com/submit?url=http%3a%2f%2frootsongjc.github.io%2fblogs%2fdocker-source-code-analysis-code-structure%2f" target="_blank" title="Reddit" class="reddit"><span class="icon icon-reddit"></span>Reddit</a> </li>
            </ul>
            <span class="subcount">sharing is caring</span>
        </div>
    </li>
    <li id="follow">
        <span class="icon icon-rocket"> </span>
        <span class="title"> follow </span>
        <div class="dropdown follow">
            <ul class="social">
                <li> <a href="http://www.twitter.com/rootsongjc" target="_blank" title="Follow me on Twitter" class="twitter"><span class="icon icon-twitter"></span>Twitter</a> </li>
                <li> <a href="http://www.facebook.com/rootsongjc" target="_blank" title="Join me on Facebook" class="facebook"><span class="icon icon-facebook"></span>Facebook</a> </li>
                <li> <a href="http://www.linkedin.com/in/rootsongjc" target="_blank" title="LinkedIn" class="linkedin"><span class="icon icon-linkedin"></span>LinkedIn</a> </li>
                <li> <a href="http://github.com/rootsongjc" target="_blank" title="GitHub" class="github"><span class="icon icon-github"></span>GitHub</a> </li>
                <li> <a href="https://www.douban.com/people/deamonj/" target="_blank" title="豆瓣" class="facebook"><span class="icon icon-idea"></span>Douban</a> </li>
                <li> <a href="https://rootsongjc.tuchong.com/" target="_blank" title="图虫" class="github"><span class="icon icon-cc-2"></span>Tuchong</a> </li>
            </ul>
            <span class="subcount">join 10k+ subscribers &amp; followers</span>
        </div>
    </li>
</ul>
    </nav>
</header>
 

    <section id="main">
        <h1 itemprop="name" id="title">Docker源码分析第一篇——代码结构</h1>
        <div>
            <article itemprop="articleBody" id="content">
                

<p><img src="http://olz1di9xf.bkt.clouddn.com/20151001042.jpg" alt="八达岭长城" /></p>

<p><em>(题图：北京八达岭长城  Oct 1,2015)</em></p>

<h2 id="前言">前言</h2>

<p>之前陆陆续续看过一点<strong>docker</strong>的源码，都未成体系，最近在研究<strong>Docker-17.03-CE</strong>，趁此机会研究下docker的源码，在网上找到一些相关资料，都比较过时了，发现*孙宏亮*大哥写过一本书叫《Docker源码分析》，而且之前也在<strong>InfoQ</strong>上陆续发过一些文章，虽然文章都比较老了，基于老的docker版本，但我认为依然有阅读的价值。起码能有这三方面收获：</p>

<ul>
<li>一是培养阅读源码的思维方式，为自己阅读docker源码提供借鉴。</li>
<li>二是可以了解docker版本的来龙去脉。</li>
<li>三还可以作为Go语言项目开发作为借鉴。</li>
</ul>

<h3 id="下载地址">下载地址</h3>

<p>鉴于这本书已经发行一年半了了，基于的docker版本还是<strong>1.2.0</strong>，而如今都到了<strong>1.13.0</strong>（docker17.03的老版本号），应该很少有人买了吧，可以说这本书的纸质版本的生命周期也差不多了吧。如果有人感兴趣可以下载pdf版本看看，<a href="http://olz1di9xf.bkt.clouddn.com/Docker%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-%E5%AD%99%E5%AE%8F%E4%BA%AE%E8%91%97.pdf">Docker源码解析-机械工业出版社-孙宏亮著-2015年8月</a>（完整文字版，大小25.86M），<a href="http://olz1di9xf.bkt.clouddn.com/Docker%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-%E5%AD%99%E5%AE%8F%E4%BA%AE-%E7%9C%8B%E4%BA%91%E7%89%88.pdf">Docker源码解析-看云整理版</a>（文字版，有缩略，大小7.62M）。</p>

<h2 id="out-of-date">Out-of-date</h2>

<p>有一点必须再次强调一下，这本书中的docker源码分析是基于<strong>docker1.2.0</strong>，而这个版本的docker源码在github上已经无法下载到了，github上available的最低版本的docker源码是<strong>1.4.1</strong>。</p>

<blockquote>
<p>顺便感叹一句，科技行业发展实在太快了，尤其是互联网，一本书能连续用上三年都不过时，如果这样的话那么这门技术恐怕都就要被淘汰了吧？</p>
</blockquote>

<h2 id="总体架构">总体架构</h2>

<p>Docker总体上是用的是<strong>Client/Server</strong>模式，所有的命令都可以通过RESTful接口传递。</p>

<p>整个Docker软件的架构中可以分成三个角色：</p>

<ul>
<li><strong>Daemon</strong>：常驻后台运行的进程，接收客户端请求，管理docker容器。</li>
<li><strong>Clien</strong>t：命令行终端，包装命令发送API请求。</li>
<li><strong>Engine</strong>：真正处理客户端请求的后端程序。</li>
</ul>

<h2 id="代码结构">代码结构</h2>

<p>Docker的代码结构比较清晰，分成的目录比较多，有以下这些：</p>

<ul>
<li><strong>api</strong>：定义API，使用了<strong>Swagger2.0</strong>这个工具来生成API，配置文件在<code>api/swagger.yaml</code></li>
<li><strong>builder</strong>：用来build docker镜像的包，看来历史比较悠久了</li>
<li><strong>bundles</strong>：这个包是在进行<a href="http://rootsongjc.github.io/blogs/docker-dev-env/">docker源码编译和开发环境搭建</a>的时候用到的，编译生成的二进制文件都在这里。</li>
<li><strong>cli</strong>：使用<a href="http://www.github.com/spf13/cobra">cobra</a>工具生成的docker客户端命令行解析器。</li>
<li><strong>client</strong>：接收<code>cli</code>的请求，调用RESTful API中的接口，向server端发送http请求。</li>
<li><strong>cmd</strong>：其中包括<code>docker</code>和<code>dockerd</code>两个包，他们分别包含了客户端和服务端的main函数入口。</li>
<li><strong>container</strong>：容器的配置管理，对不同的platform适配。</li>
<li><strong>contrib</strong>：这个目录包括一些有用的脚本、镜像和其他非docker core中的部分。</li>
<li><strong>daemon</strong>：这个包中将docker deamon运行时状态expose出来。</li>
<li><strong>distribution</strong>：负责docker镜像的pull、push和镜像仓库的维护。</li>
<li><strong>dockerversion</strong>：编译的时候自动生成的。</li>
<li><strong>docs</strong>：文档。这个目录已经不再维护，文档在另一个仓库里<a href="https://github.com/docker/docker.github.io/。">https://github.com/docker/docker.github.io/。</a></li>
<li><strong>experimental</strong>：从docker1.13.0版本起开始增加了实验特性。</li>
<li><strong>hack</strong>：创建docker开发环境和编译打包时用到的脚本和配置文件。</li>
<li><strong>image</strong>：用于构建docker镜像的。</li>
<li><strong>integration-cli</strong>：集成测试</li>
<li><strong>layer</strong>：管理 union file system driver上的read-only和read-write mounts。</li>
<li><strong>libcontainerd</strong>：访问内核中的容器系统调用。</li>
<li><strong>man</strong>：生成man pages。</li>
<li><strong>migrate</strong>：将老版本的graph目录转换成新的metadata。</li>
<li><strong>oci</strong>：Open Container Interface库</li>
<li><strong>opts</strong>：命令行的选项库。</li>
<li><strong>pkg</strong>：</li>
<li><strong>plugin</strong>：docker插件后端实现包。</li>
<li><strong>profiles</strong>：里面有apparmor和seccomp两个目录。用于内核访问控制。</li>
<li><strong>project</strong>：项目管理的一些说明文档。</li>
<li><strong>reference</strong>：处理docker store中镜像的reference。</li>
<li><strong>registry</strong>：docker registry的实现。</li>
<li><strong>restartmanager</strong>：处理重启后的动作。</li>
<li><strong>runconfig</strong>：配置格式解码和校验。</li>
<li><strong>vendor</strong>：各种依赖包。</li>
<li><strong>volume</strong>：docker volume的实现。</li>
</ul>

<p>下一篇将讲解docker的各个功能模块和原理。</p>

            </article>
        </div>
    </section>

    
    

<aside id="meta">

<div>
    <section id="datecount">
        <h4 id="date"> Sun Mar 19, 2017 </h4>
        <h5 id="wc"> 100 Words </h5>
        <h5 id="readtime"> Read in about 1 Min </h5>
    </section>
    <ul id="categories">
        
    </ul>
    <ul id="tags">
        
        <li> <a href="http://rootsongjc.github.io//tags/docker">docker</a> </li>
        
        <li> <a href="http://rootsongjc.github.io//tags/docker-source-code-analysis">docker source code analysis</a> </li>
        
    </ul>
</div>

<div>
    <section id="prev">
        &nbsp;<a class="previous" href="http://rootsongjc.github.io/blogs/tensorflow-practice-01/"><i class="icon-arrow-left"></i> TensorFlow实战（才云郑泽宇著）读书笔记——第一章深度学习简介</a><br>
    </section>
    <section id="next">
        &nbsp;<a class="next" href="http://rootsongjc.github.io/about/">About Jimmy Song <i class="icon-arrow-right"></i></a>
    </section>
</div>

<div>
    <section id="author">
        <h4>About the Author</h4>
        <p>
            <a href="http://rootsongjc.github.io/about/">Jimmy Song</a> is a software engineer in Beijing, also an open source enthusiast and Big Data, Cloud Native fans. If you not see him front of computer, he must be traveling or taking pictures outside,
            visit the amazing pictures at <a href=https://rootsongjc.tuchong.com/>tuchong(图虫)</a>. Feel free to <a href=https://twitter.com/rootsongjc>follow him on twitter</a>.
        </p>
    </section>

</div>
</aside>

<meta itemprop="wordCount" content="69">
<meta itemprop="datePublished" content="2017-03-19">
<meta itemprop="url" content="http://rootsongjc.github.io/blogs/docker-source-code-analysis-code-structure/">
 <footer>
  <div>
    <p>
    &copy; 2013-2017 <span itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Jimmy Song</span></span>
    Powered by <a href="http://gohugo.io">Hugo</a>.
    </p>
  </div>
</footer>
</body>
</html>

